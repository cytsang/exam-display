<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HK Analog Clock</title>
  <style>
    :root{
      --bg:#ffffff;
      --panel:#f6f7f9;
      --border:#d9dde3;
      --text:#111827;
      --muted:#9aa3af;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "PingFang HK", "Noto Sans TC", Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .wrap{
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
    }
    .stage{
      width: min(1100px, 100%);
      display:flex;
      gap: 28px;
      align-items:center;
    }

    /* LEFT */
    .clockShell{
      flex: 1 1 60%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
.clockCircle{
  width: min(560px, 68vw);
  aspect-ratio: 1 / 1;
  border: 10px solid #2563eb;   /* 藍色粗圓框（Tailwind blue-600） */
  border-radius: 999px;
  background: #fff;
  box-shadow: 0 12px 30px rgba(37,99,235,.25); /* 藍色陰影 */
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 16px;               /* 因為邊框加粗，縮少 padding */
  position: relative;
}


.face{
  width: 100%;
  height: 100%;
  border-radius: 999px;
  position: relative;
  background:
    radial-gradient(circle at center, rgba(0,0,0,.06) 0 2px, transparent 3px),
    radial-gradient(circle at center, rgba(0,0,0,.04) 0 55%, transparent 56%),
    #fff7cc;   /* 淺黃色鐘面 */
}


    /* marks */
    .mark{
      position:absolute;
      left:50%;
      top:50%;
      width: 7px;
      height: 22px;
      background: rgba(17,24,39,.70);
      border-radius: 6px;
      transform: translate(-50%, -50%) rotate(0deg) translateY(-46%);
    }
    .mark.minor{
      width: 3px;
      height: 12px;
      background: rgba(17,24,39,.22);
      border-radius: 6px;
    }

    /* numbers 1-12 */
    .num{
  position:absolute;
  transform: translate(-50%, -50%);
  font-variant-numeric: tabular-nums;
  font-weight: 850;
  font-size: clamp(18px, 2.2vw, 26px);
  color: rgba(17,24,39,.75);
  user-select: none;
  pointer-events: none;
  text-shadow: 0 1px 0 rgba(255,255,255,.6);
  z-index: 2; /* 確保喺刻度之上 */
}


    /* hands */
    .hand{
      position:absolute;
      left:50%;
      top:50%;
      transform-origin: 50% 100%;
      border-radius: 999px;
      transform: translate(-50%, -100%) rotate(0deg);
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
    }

    /* thicker hour/minute hands */
    .hand.hour{
      width: 14px;
      height: 30%;
      background: rgba(17,24,39,.90);
    }
    .hand.minute{
      width: 10px;
      height: 42%;
      background: rgba(17,24,39,.82);
    }

    /* keep second hand */
    .hand.second{
      width: 3px;
      height: 48%;
      background: rgba(220,38,38,.95);
      box-shadow: none;
    }

    .hub{
      position:absolute;
      left:50%;
      top:50%;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      transform: translate(-50%,-50%);
      background: rgba(17,24,39,.96);
      box-shadow: 0 2px 10px rgba(0,0,0,.18);
      z-index: 5;
    }
    .hub::after{
      content:"";
      position:absolute;
      inset: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,.18);
    }

    .readout{
      position:absolute;
      left:50%;
      bottom: 7%;
      transform: translateX(-50%);
      text-align:center;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(246,247,249,.88);
      backdrop-filter: blur(6px);
      min-width: 240px;
    }
    .digital{
      font-variant-numeric: tabular-nums;
      font-weight: 850;
      font-size: 24px;
      letter-spacing: .5px;
    }
    .status{
      margin-top: 4px;
      font-size: 12px;
      color: #6b7280;
    }

    /* RIGHT */
    .side{
      flex: 0 0 min(420px, 100%);
      display:flex;
      flex-direction:column;
      gap: 16px;
      height: min(520px, 70vh);
    }
    .field{
      background: var(--panel);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 8px 18px rgba(0,0,0,.05);
      padding: 14px 16px;
      display:flex;
      overflow:hidden;
    }
    .field.main { flex: 5; }
    .field.time { flex: 4; }

    .field.main input{
  font-size: 50px;  /* 5份 */
  font-weight: 850;
}

.field.time input{
  font-size: 30px;  /* 4份 */
  font-weight: 850;
}

/* RIGHT container */
.side{
  flex: 0 0 min(520px, 100%); /* 稍闊少少，唔想改可保留 420px */
  display:flex;
  flex-direction:column;
  gap: 16px;
  height: min(520px, 70vh);
  position: relative;
}

/* groups list takes all space */
.groups{
  flex: 1;
  display:flex;
  flex-direction:column;
  gap: 18px;
  min-height: 0; /* important for flex children shrink */
  padding-right: 70px; /* 留位畀右下角加號唔會遮住內容 */
}

/* each group: two fields stacked */
.group{
  flex: 1;                 /* 令每組平均分配高度 -> 新增越多，每組越矮 */
  display:flex;
  flex-direction:column;
  gap: 14px;
  min-height: 0;
}

/* field box (你原本已有可以保留，但要加 min-height:0) */
.field{
  background: var(--panel);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  box-shadow: 0 8px 18px rgba(0,0,0,.05);
  padding: 14px 16px;
  display:flex;
  overflow:hidden;
  min-height: 0;
}

/* height ratio 5:4 inside each group */
.field.main { flex: 5; }
.field.time { flex: 4; }

/* multi-line main */
.field.main textarea{
  width:100%;
  height:100%;
  border:0;
  outline:none;
  background:transparent;
  color: var(--text);
  font-size: 48px;   /* main = 5份 */
  font-weight: 800;
  letter-spacing: .2px;
  line-height: 1.08;
  resize: none;      /* 避免右下角拉伸手柄破壞版面 */
  padding: 2px 2px;
}

/* time (single line) */
.field.time input{
  width:100%;
  height:100%;
  border:0;
  outline:none;
  background:transparent;
  color: var(--text);
  font-size: 38px;   /* time = 4份 */
  font-weight: 800;
  letter-spacing: .2px;
  padding: 2px 2px;
}

/* placeholder */
.field textarea::placeholder,
.field input::placeholder{
  color: var(--muted);
  font-weight: 700;
}

/* plus button (bottom-right) */
.addBtn{
  position:absolute;
  right: 8px;
  bottom: 8px;
  width: 54px;
  height: 54px;
  border-radius: 999px;
  border: 2px solid var(--border);
  background: #ffffff;
  box-shadow: 0 10px 22px rgba(0,0,0,.10);
  font-size: 34px;
  line-height: 1;
  font-weight: 900;
  cursor: pointer;
  user-select:none;
}
.addBtn:active{
  transform: translateY(1px);
}

/* small screens: keep okay */
@media (max-width: 900px){
  .groups{ padding-right: 0; }
  .addBtn{ right: 12px; bottom: 12px; }
  .field.main textarea{ font-size: 40px; }
  .field.time input{ font-size: 32px; }
}


    input{
      width:100%;
      height:100%;
      border:0;
      outline:none;
      background:transparent;
      color: var(--text);
      font-size: 40px;
      font-weight: 800;
      letter-spacing: .2px;
      padding: 2px 2px;
    }
    input::placeholder{
      color: var(--muted);
      font-weight: 700;
    }

    @media (max-width: 900px){
      .stage{ flex-direction:column; }
      .side{ width: min(560px, 100%); height: min(520px, 55vh); }
      .clockShell{ width: 100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="stage">
      <div class="clockShell">
        <div class="clockCircle">
          <div class="face" id="face">
            <!-- JS will insert marks + numbers -->
            <div class="hand hour" id="hHand"></div>
            <div class="hand minute" id="mHand"></div>
            <div class="hand second" id="sHand"></div>
            <div class="hub"></div>

            <div class="readout">
              <div class="digital" id="digital">--:--:--</div>
              <div class="status" id="syncStatus">Syncing…</div>
            </div>
          </div>
        </div>
      </div>

 <div class="side" id="side">
  <div class="groups" id="groups">
    <!-- 第一組（預設存在） -->
    <div class="group">
      <div class="field main">
        <textarea class="mainInput" rows="2" placeholder="Level / Subj / Paper"></textarea>
      </div>

      <div class="field time">
        <input class="timeInput" type="text" placeholder="Time">
      </div>
    </div>
  </div>

  <!-- 右下角加號 -->
  <button class="addBtn" id="addBtn" type="button" aria-label="Add another pair">＋</button>
</div>


    </div>
  </div>

  <script>
    // ====== Build marks + numbers ======
    const face = document.getElementById("face");

    // minute marks (0..59)
    for (let i = 0; i < 60; i++){
      const isHour = (i % 5 === 0);
      const d = document.createElement("div");
      d.className = "mark" + (isHour ? "" : " minor");
      d.style.transform = `translate(-50%, -50%) rotate(${i * 6}deg) translateY(-46%)`;
      face.appendChild(d);
    }

// numbers 1..12 (use trig positioning)
const R = 44; // 半徑（以鐘面 0~50% 計），想貼邊就加大到 40~42
for (let n = 1; n <= 12; n++){
  // 12 點位置喺頂：-90deg
  const angle = (n * 30 - 90) * Math.PI / 180;
  const x = 50 + R * Math.cos(angle);
  const y = 50 + R * Math.sin(angle);

  const el = document.createElement("div");
  el.className = "num";
  el.textContent = String(n);
  el.style.left = x + "%";
  el.style.top  = y + "%";
  face.appendChild(el);
}


    // ====== Online sync via Apps Script ======
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbydFg6fSuA9KQn5ZY42PRn2t09tq2Kqbrsv3TlqDPIVyNpNEadheHSmr3t2bZGxONEh/exec"; // <-- replace
    const TZ = "Asia/Hong_Kong";

    const hHand = document.getElementById("hHand");
    const mHand = document.getElementById("mHand");
    const sHand = document.getElementById("sHand");
    const digital = document.getElementById("digital");
    const syncStatus = document.getElementById("syncStatus");

    let offsetMs = 0;
    let onlineSynced = false;

    const digitalFmt = new Intl.DateTimeFormat("en-GB", {
      timeZone: TZ,
      hour: "2-digit", minute: "2-digit", second: "2-digit",
      hour12: false
    });

    function hkParts(date){
      const parts = new Intl.DateTimeFormat("en-GB", {
        timeZone: TZ,
        hour: "2-digit", minute: "2-digit", second: "2-digit",
        hour12: false
      }).formatToParts(date);

      return {
        hh: Number(parts.find(p => p.type === "hour").value),
        mm: Number(parts.find(p => p.type === "minute").value),
        ss: Number(parts.find(p => p.type === "second").value),
      };
    }

    function render(epochMs){
      const d = new Date(epochMs);
      digital.textContent = digitalFmt.format(d);

      const {hh, mm, ss} = hkParts(d);
      const hour12 = hh % 12;
      const ms = d.getMilliseconds();
      const secFloat = ss + ms / 1000;

      const secDeg = secFloat * 6;
      const minDeg = (mm + secFloat/60) * 6;
      const hourDeg = (hour12 + mm/60 + secFloat/3600) * 30;

      sHand.style.transform = `translate(-50%, -100%) rotate(${secDeg}deg)`;
      mHand.style.transform = `translate(-50%, -100%) rotate(${minDeg}deg)`;
      hHand.style.transform = `translate(-50%, -100%) rotate(${hourDeg}deg)`;
    }

    function tick(){
      render(Date.now() + offsetMs);
    }

    async function syncOnce(){
      try{
        syncStatus.textContent = "Syncing (online)…";
        const t0 = performance.now();
        const res = await fetch(SCRIPT_URL, { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if(typeof data.epochMs !== "number") throw new Error("Missing epochMs");

        const serverEpoch = data.epochMs;
        const t1 = performance.now();
        const rtt = (t1 - t0);
        const approxLocalAtMid = Date.now() - (rtt / 2);

        offsetMs = serverEpoch - approxLocalAtMid;
        onlineSynced = true;
        syncStatus.textContent = "Online synced ✓";
      }catch(e){
        syncStatus.textContent = onlineSynced ? "Sync failed (keeping last sync)" : "Offline fallback (device clock)";
      }
    }

    (async () => {
      await syncOnce();
      tick();
      setInterval(tick, 1000);
      setInterval(syncOnce, 5 * 60 * 1000);
    })();

    // ====== Add-group button ======
const groupsEl = document.getElementById("groups");
const addBtn = document.getElementById("addBtn");

function createGroup(){
  const group = document.createElement("div");
  group.className = "group";
  group.innerHTML = `
    <div class="field main">
      <textarea class="mainInput" rows="2" placeholder="Level / Subj / Paper"></textarea>
    </div>
    <div class="field time">
      <input class="timeInput" type="text" placeholder="Time">
    </div>
  `;
  return group;
}

addBtn.addEventListener("click", () => {
  const g = createGroup();
  groupsEl.appendChild(g);

  // focus new main textarea for quick typing
  const ta = g.querySelector("textarea");
  if (ta) ta.focus();
});

  </script>
</body>
</html>
